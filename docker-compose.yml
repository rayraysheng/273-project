version: '3.8'

services:
  document_management:
    build: 
      context: ./services/document_management
    container_name: document_management_service
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - DOCUMENT_MANAGEMENT_PORT=${DOCUMENT_MANAGEMENT_PORT}
    ports:
      - "${DOCUMENT_MANAGEMENT_PORT}:${DOCUMENT_MANAGEMENT_PORT}"
    #depends_on:
    #  - database
    volumes:
      - ./services/document_management/app/data:/app/data
    develop:
      watch:
        - action: sync
          path: ./services/document_management/app
          target: /app
          ignore:
            - __pychache__
            - "*.pyc"
        - action: rebuild
          path: ./services/document_management/requirements.txt
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:${DOCUMENT_MANAGEMENT_PORT}/"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  chromadb_data:
